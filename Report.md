# Домашнее задание №10 (Тема "Виды и устройство репликации в PostgreSQL. Практика применения")

Описание/Пошаговая инструкция выполнения домашнего задания:

<br>__*Создал три виртуальные машины.*__
> <img src="pic/0.JPG" align="center" />

<br>__*На каждой из трех виртуальных машин развернул кластер Postgres версии 15.*__
<br>__*Далее начал настраивать ВМ для логической репликации. Изменил значение параметра "listen_addresses", специальная запись * соответствует всем доступным IP-интерфейсам. Чтобы изменение применилось перезапустил кластер Postgres.*__
> <img src="pic/0_1.JPG" align="center" />

<br>__*Далее внес изменения в файл "pg_hba.conf" в раздел "# IPv4 local connections", указав подсети наших ВМ и сделав доверительные связи. Это позволит нашим клиентам (client) подключаться к Postgres.*__
> <img src="pic/0_2.JPG" align="center" />

<br>__*Следующее изменение - это установка для параметра "wal_level" значения "logical" вместо "replica". Чтобы изменение применилось перезапустил кластер Postgres.*__
> <img src="pic/0_3.JPG" align="center" />

<br>__*Все перечисленные действия я проделал на всех трех виртуальных машинах.*__

* На 1 ВМ создаем таблицы test для записи, test2 для запросов на чтение.
  
<br>__*На первой виртуальной машине создал базу данных "db1". В ней в схеме public создал таблицы "test1", "test2". У вновь созданной таблицы "test1" сделал публикацию "publ1".*__
> <img src="pic/1_1.JPG" align="center" />
* На 2 ВМ создаем таблицы test2 для записи, test для запросов на чтение.

<br>__*На второй виртуальной машине создал базу данных "db2". В ней в схеме public также создал таблицы "test1", "test2". Но публикацию уже сделал  таблицы "test2", назвал публикацию "publ2".*__
> <img src="pic/1_2.JPG" align="center" />  
* Создаем публикацию таблицы test и подписываемся на публикацию таблицы test2 с ВМ №2.

<br>__*Публикацию "publ2" таблицы "test2" создали ранее на второй виртуальной машине. Теперь на первой виртуальной машине подписываемся на эту публикацию.*__
> <img src="pic/2_1.JPG" align="center" />
* Создаем публикацию таблицы test2 и подписываемся на публикацию таблицы test1 с ВМ №1.

<br>__*Аналогично делаем на второй виртуальной машине, подписываемся на публикацию "publ1" таблицы "test1" первой ВМ.*__
> <img src="pic/2_2.JPG" align="center" />
* ВМ 3 использовать как реплику для чтения и бэкапов (подписаться на таблицы из ВМ №1 и №2 ).
  
<br>__*На третьей виртуальной машине подписываемся на публикации "publ1" первой ВМ и "publ2" второй ВМ.*__
> <img src="pic/2_3.JPG" align="center" />

<br>__*Теперь протестирую как работают репликации.*__
<br>__*Публикация "publ1" таблицы "test1" первой ВМ. При добавлении записей в таблицу "test1", эти же записи появляются на второй ВМ в таблице "test1". Репликация работает.*__
> <img src="pic/3_1.JPG" align="center" />

<br>__*Публикация "publ2" таблицы "test2" второй ВМ. При добавлении записей в таблицу "test2", эти же записи появляются на первой ВМ в таблице "test2". Репликация работает.*__
> <img src="pic/3_2.JPG" align="center" />

<br>__*Теперь проверяю подписки на третьей ВМ. При добавлении записей в таблицу "test1" на первой ВМ и при добавлении записей в таблицу "test2" на второй ВМ эти данные автоматически появляются в соответствующих таблицах в третьей ВМ. Эта репликация тоже работает.*__
> <img src="pic/3_3.JPG" align="center" />
